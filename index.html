<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Estoque SAP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --ml-yellow: #fff159; 
            --bg: #ebebeb; 
            --blue: #3483fa; 
            --text: #333; 
            --green: #00a650; 
            --white: #ffffff;
        }

        body { 
            background-color: var(--bg); 
            font-family: 'Proxima Nova', -apple-system, 'Helvetica Neue', Helvetica, Roboto, Arial, sans-serif; 
            margin: 0; 
            color: var(--text); 
        }
        
        /* Cabe√ßalho Estilo Mercado Livre */
        header { 
            background-color: var(--ml-yellow); 
            padding: 10px 5%; 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }

        .logo { 
            font-weight: bold; 
            font-size: 22px; 
            letter-spacing: -1px; 
            text-decoration: none;
            color: #333;
            min-width: 150px;
        }

        .search-container { flex-grow: 1; position: relative; }
        .search-container input { 
            width: 100%; 
            padding: 10px 15px; 
            border: none; 
            border-radius: 2px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.2); 
            outline: none; 
            font-size: 16px; 
        }
        
        .cart-icon { 
            position: relative; 
            cursor: pointer; 
            font-size: 24px; 
            color: #333;
        }

        .cart-count { 
            position: absolute; 
            top: -8px; 
            right: -10px; 
            background: #e50914; 
            color: white; 
            font-size: 12px; 
            padding: 2px 6px; 
            border-radius: 50%; 
            font-weight: bold; 
        }

        /* Container de Produtos */
        .container { 
            padding: 20px 5%; 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }

        .item-card { 
            background: var(--white); 
            border-radius: 6px; 
            padding: 20px; 
            transition: 0.2s; 
            display: flex; 
            flex-direction: column; 
            border-bottom: 3px solid transparent;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.1);
        }

        .item-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
            border-color: var(--blue); 
        }
        
        .sap-code { color: #666; font-size: 12px; font-weight: bold; margin-bottom: 8px; }
        .item-title { 
            font-size: 16px; 
            font-weight: 400; 
            color: #333; 
            margin: 0 0 12px 0; 
            line-height: 1.3; 
            height: 42px; 
            overflow: hidden; 
        }

        .item-loc { 
            font-size: 12px; 
            color: #999; 
            margin-bottom: 15px; 
            background: #f5f5f5;
            padding: 5px;
            border-radius: 3px;
        }

        .item-stock { 
            font-size: 18px; 
            color: var(--green); 
            font-weight: bold; 
            margin-top: auto; 
        }

        .unit { font-size: 12px; color: #666; font-weight: normal; }
        
        .btn-add { 
            background: var(--blue); 
            color: white; 
            border: none; 
            width: 100%; 
            padding: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            border-radius: 6px; 
            margin-top: 15px; 
            transition: 0.2s; 
        }

        .btn-add:hover { background: #2968c8; }

        /* Carrinho Lateral */
        #modal-cart { 
            display: none; 
            position: fixed; 
            right: 0; 
            top: 0; 
            width: 380px; 
            height: 100%; 
            background: white; 
            box-shadow: -5px 0 15px rgba(0,0,0,0.2); 
            z-index: 200; 
            padding: 25px; 
            box-sizing: border-box; 
        }

        .cart-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 15px; 
            margin-bottom: 15px;
        }

        .cart-item { 
            padding: 12px 0; 
            border-bottom: 1px solid #f5f5f5; 
            font-size: 14px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }

        .btn-finish { 
            background: var(--green); 
            color: white; 
            border: none; 
            width: 100%; 
            padding: 15px; 
            cursor: pointer; 
            font-weight: bold; 
            border-radius: 6px; 
            margin-top: 25px; 
            font-size: 16px;
        }
        
        #order-text { 
            background: #f9f9f9; 
            padding: 15px; 
            border: 1px dashed #ccc;
            border-radius: 4px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            margin-top: 20px; 
            display: none; 
            white-space: pre-wrap; 
        }

        .loading-screen {
            grid-column: 1/-1;
            text-align: center;
            padding: 100px;
            color: #666;
        }

        @media (max-width: 600px) { 
            #modal-cart { width: 100%; } 
            header { padding: 10px 2%; }
            .logo { min-width: 100px; font-size: 18px; }
        }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo">SAP<span style="color:var(--blue)">ESTOQUE</span></a>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Pesquisar por material ou c√≥digo SAP..." onkeyup="filtrar()">
    </div>
    <div class="cart-icon" onclick="toggleCart()">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
    </div>
</header>

<div class="container" id="catalog">
    <div class="loading-screen">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color: var(--blue)"></i>
        <p style="margin-top: 20px; font-weight: bold;">Sincronizando com a planilha SAP...</p>
    </div>
</div>

<div id="modal-cart">
    <div class="cart-header">
        <h3>Minha Solicita√ß√£o</h3>
        <i class="fas fa-times" onclick="toggleCart()" style="cursor:pointer; font-size: 20px;"></i>
    </div>
    <div id="cart-list" style="max-height: 55vh; overflow-y: auto;"></div>
    <button class="btn-finish" onclick="gerarPedido()">
        <i class="fas fa-copy"></i> COPIAR PEDIDO PARA CHAT
    </button>
    <div id="order-text"></div>
    <p style="font-size: 10px; color: #999; margin-top: 10px; text-align: center;">
        Dica: Ap√≥s copiar, basta dar Ctrl+V no Google Chat ou WhatsApp.
    </p>
</div>

<script>
    // URL ATUALIZADA DO SEU APPS SCRIPT
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbzA4B6rIJ-L5B1xUZ9le9cLD9pPP6xwXB6n_Z2k5D6-k-EUtfDm3XNoo4HD4o_jAxHk9g/exec";
    
    let db = [];
    let cart = [];

    async function loadData() {
        try {
            const response = await fetch(URL_SCRIPT);
            db = await response.json();
            render(db);
        } catch (error) {
            document.getElementById('catalog').innerHTML = `
                <div class="loading-screen" style="color: #e50914;">
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <p>Erro ao conectar com a planilha. Verifique a implanta√ß√£o do Google.</p>
                </div>`;
        }
    }

    function render(list) {
        const catalog = document.getElementById('catalog');
        if(list.length === 0) {
            catalog.innerHTML = '<div class="loading-screen"><p>Nenhum item encontrado.</p></div>';
            return;
        }
        
        catalog.innerHTML = list.map(item => `
            <div class="item-card">
                <div class="sap-code">SAP: ${item.sap}</div>
                <h2 class="item-title">${item.nome}</h2>
                <div class="item-loc">
                    <i class="fas fa-warehouse"></i> ${item.centro} | ${item.dp}
                </div>
                <div class="item-stock">
                    ${item.disponivel} <span class="unit">${item.unidade}</span>
                </div>
                <button class="btn-add" onclick="addToCart('${item.sap}')">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
        `).join('');
    }

    function filtrar() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = db.filter(item => 
            item.nome.toLowerCase().includes(query) || 
            item.sap.toString().includes(query)
        );
        render(filtered);
    }

    function addToCart(sap) {
        const item = db.find(i => i.sap == sap);
        const cartItem = cart.find(c => c.sap == sap);
        
        if(cartItem) {
            cartItem.qtd++;
        } else {
            cart.push({...item, qtd: 1});
        }
        
        updateCartUI();
        // Feedback visual simples
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> OK!';
        btn.style.background = "#00a650";
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = "#3483fa";
        }, 800);
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.reduce((total, item) => total + item.qtd, 0);
        const listContainer = document.getElementById('cart-list');
        
        if(cart.length === 0) {
            listContainer.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">Seu carrinho est√° vazio.</p>';
            return;
        }

        listContainer.innerHTML = cart.map(item => `
            <div class="cart-item">
                <span><strong>${item.qtd}x</strong> ${item.nome.substring(0, 30)}...</span>
                <div style="display:flex; align-items:center; gap:10px">
                    <span style="color:#666; font-size:11px">SAP: ${item.sap}</span>
                    <i class="fas fa-trash" onclick="removeFromCart('${item.sap}')" style="color:#ff4d4d; cursor:pointer"></i>
                </div>
            </div>
        `).join('');
    }

    function removeFromCart(sap) {
        cart = cart.filter(i => i.sap != sap);
        updateCartUI();
    }

    function toggleCart() {
        const modal = document.getElementById('modal-cart');
        modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
    }

    function gerarPedido() {
        if(cart.length === 0) {
            alert("Adicione itens ao carrinho primeiro!");
            return;
        }

        let textoPedido = `üì¶ *SOLICITA√á√ÉO DE MATERIAL - SAP*\n`;
        textoPedido += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
        
        cart.forEach(item => {
            textoPedido += `üîπ *${item.qtd}x* | SAP: ${item.sap}\n`;
            textoPedido += `   ${item.nome}\n`;
            textoPedido += `   Local: ${item.centro} / ${item.dp}\n\n`;
        });
        
        textoPedido += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        textoPedido += `üìÖ Data: ${new Date().toLocaleString('pt-BR')}\n`;
        textoPedido += `üë§ Solicitado via: Cat√°logo Digital`;

        const orderDisplay = document.getElementById('order-text');
        orderDisplay.innerText = textoPedido;
        orderDisplay.style.display = 'block';

        // Copiar para √°rea de transfer√™ncia
        navigator.clipboard.writeText(textoPedido).then(() => {
            alert("Pedido copiado! Agora √© s√≥ colar no Google Chat.");
        }).catch(err => {
            alert("Erro ao copiar automaticamente. Por favor, copie manualmente do campo cinza.");
        });
    }

    window.onload = loadData;
</script>

</body>
</html>
