<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque SAP - Mercado Livre Style</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --ml-yellow: #fff159; --bg: #ebebeb; --blue: #3483fa; --text: #333; --green: #00a650; }
        body { background-color: var(--bg); font-family: 'Arial', sans-serif; margin: 0; color: var(--text); }
        
        /* Header ML */
        header { background-color: var(--ml-yellow); padding: 10px 5%; display: flex; align-items: center; gap: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .search-container { flex-grow: 1; position: relative; }
        .search-container input { width: 100%; padding: 10px 15px; border: none; border-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); outline: none; font-size: 16px; }
        
        .cart-icon { position: relative; cursor: pointer; font-size: 24px; }
        .cart-count { position: absolute; top: -8px; right: -10px; background: #e50914; color: white; font-size: 12px; padding: 2px 6px; border-radius: 50%; font-weight: bold; }

        /* Grid de Itens */
        .container { padding: 20px 5%; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .item-card { background: white; border-radius: 4px; padding: 15px; transition: 0.3s; display: flex; flex-direction: column; border-bottom: 3px solid transparent; }
        .item-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: var(--blue); }
        
        .sap-code { color: #666; font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        .item-title { font-size: 15px; font-weight: 400; color: #333; margin: 0 0 10px 0; line-height: 1.2; height: 36px; overflow: hidden; }
        .item-stock { font-size: 14px; color: var(--green); font-weight: bold; margin-top: auto; }
        .item-loc { font-size: 11px; color: #999; margin-bottom: 10px; }
        
        .btn-add { background: var(--blue); color: white; border: none; width: 100%; padding: 10px; cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 10px; transition: 0.2s; }
        .btn-add:hover { background: #2968c8; }

        /* Modal Carrinho lateral */
        #modal-cart { display: none; position: fixed; right: 0; top: 0; width: 350px; height: 100%; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.2); z-index: 200; padding: 20px; box-sizing: border-box; }
        .cart-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .cart-item { padding: 10px 0; border-bottom: 1px solid #f5f5f5; font-size: 13px; display: flex; justify-content: space-between; }
        .btn-finish { background: var(--green); color: white; border: none; width: 100%; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 4px; margin-top: 20px; }
        
        #order-text { background: #f0f0f0; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 11px; margin-top: 15px; display: none; white-space: pre-wrap; }
        
        @media (max-width: 600px) { #modal-cart { width: 100%; } }
    </style>
</head>
<body>

<header>
    <div style="font-weight: bold; font-size: 22px; letter-spacing: -1px;">SAP<span style="color:var(--blue)">ESTOQUE</span></div>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Buscar por SAP ou nome do item..." onkeyup="filtrar()">
    </div>
    <div class="cart-icon" onclick="toggleCart()">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
    </div>
</header>

<div class="container" id="catalog">
    <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">
        <i class="fas fa-spinner fa-spin fa-2x"></i><br><br>Carregando estoque atualizado...
    </div>
</div>

<div id="modal-cart">
    <div class="cart-header">
        <h3>Solicita√ß√£o de Itens</h3>
        <i class="fas fa-times" onclick="toggleCart()" style="cursor:pointer"></i>
    </div>
    <div id="cart-list" style="max-height: 60vh; overflow-y: auto;"></div>
    <button class="btn-finish" onclick="gerarPedido()">FECHAR PEDIDO E COPIAR</button>
    <div id="order-text"></div>
</div>

<script>
    const URL_SCRIPT = "COLE_AQUI_A_URL_DO_SEU_APPS_SCRIPT";
    let db = [];
    let cart = [];

    async function load() {
        try {
            const r = await fetch(URL_SCRIPT);
            db = await r.json();
            render(db);
        } catch (e) { alert("Erro ao carregar dados da planilha."); }
    }

    function render(list) {
        const catalog = document.getElementById('catalog');
        if(list.length === 0) {
            catalog.innerHTML = '<p style="grid-column:1/-1; text-align:center">Nenhum item encontrado.</p>';
            return;
        }
        catalog.innerHTML = list.map(item => `
            <div class="item-card">
                <div class="sap-code">SAP: ${item.sap}</div>
                <h2 class="item-title">${item.nome}</h2>
                <div class="item-loc">Centro: ${item.centro} | DP: ${item.dp}</div>
                <div class="item-stock">${item.disponivel} ${item.unidade} dispon√≠veis</div>
                <button class="btn-add" onclick="addToCart('${item.sap}')">Adicionar</button>
            </div>
        `).join('');
    }

    function filtrar() {
        const val = document.getElementById('searchInput').value.toLowerCase();
        const filtered = db.filter(i => 
            i.nome.toLowerCase().includes(val) || 
            i.sap.toString().includes(val)
        );
        render(filtered);
    }

    function addToCart(sap) {
        const item = db.find(i => i.sap == sap);
        const exists = cart.find(c => c.sap == sap);
        if(exists) exists.qtd++;
        else cart.push({...item, qtd: 1});
        updateCartUI();
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.reduce((s, i) => s + i.qtd, 0);
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map(i => `
            <div class="cart-item">
                <span><b>${i.qtd}x</b> ${i.nome}</span>
                <span>SAP: ${i.sap}</span>
            </div>
        `).join('');
    }

    function toggleCart() {
        const m = document.getElementById('modal-cart');
        m.style.display = m.style.display === 'block' ? 'none' : 'block';
    }

    function gerarPedido() {
        if(cart.length === 0) return alert("Carrinho vazio!");
        let t = `üìã *SOLICITA√á√ÉO DE MATERIAL - SAP*\n`;
        t += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        cart.forEach(i => {
            t += `üîπ *${i.qtd}x* | SAP: ${i.sap}\n   ${i.nome}\n\n`;
        });
        t += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
        t += `üìç Gerado em: ${new Date().toLocaleString()}`;
        
        const box = document.getElementById('order-text');
        box.innerText = t;
        box.style.display = 'block';
        
        navigator.clipboard.writeText(t).then(() => {
            alert("Pedido copiado com sucesso! Agora cole no Google Chat.");
        });
    }

    window.onload = load;
</script>
</body>
</html>
